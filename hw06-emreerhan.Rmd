---
title: "R Notebook"
author: Emre Erhan
date: '2018-11-09'
theme: yeti
output: github_document
---

## Import required packages

```{r results='hide', message=FALSE, warning=FALSE}
library(stringr)
library(gapminder)
library(ggplot2)
library(dplyr)
library(testthat)
```

## 1. Writ


## 2. Writing useful functions

In computational biology, when working with DNA sequences, it is often useful to get the "canonical" version of a string of DNA bases. The canonical version is either the lexographically maximal or lexographically minimal complement of the sequence. I will write a function that returns the canonical sequence for a given DNA sequence.

### Preliminary functions

Let's start by writing a function that returns the complementary sequence of a DNA sequence.

```{r}
complementary = function(seq){
  complement = chartr("ATGCN", "TACGN", seq) # chartr maps characters to characters. We use this to determine the complementary basepairs
  return(complement)
}
```

We'll use this complementary function in the canonical function

```{r}
canonical = function(seq){
  complement = complementary(seq)
  if (seq > complement){
    return(seq)
  }
  else{
    return(complement)
  }
}
```

### Preliminary tests

Let's give it a shot! The canonical sequence of "ACGT" and "TGCA" should both be the same, since they're complementary sequences. Let's use `test_that`

```{r}

test_that("Testing if the complement function works", {
  expect_equal(complementary("ACGT"), "TGCA")
})

test_that("A simple test", {
  expect_equal(canonical("ACGT"), canonical("TGCA"))
})
```

### Adding optional parameters

It works! Although, it may be useful to specify whether the maximal or minimal complement is required. I'll provide that option in a parameter.

```{r}
canonical = function(seq, minimal = TRUE){
  complement = complementary(seq)
  if (minimal){
    return(min(seq, complement))
  }
  else{
    return(max(seq, complement))
  }
}
```

### Testing parameters

Let's make some test cases using `test_that`

```{r}
long_seq = 'ACGTCGATCGATGCTAGCTAGCTAGTCGACTATCAGTAG'
test_that("Testing complementary sequences", {
  expect_equal(canonical("ACGT"), canonical("TGCA"))
  expect_equal(canonical(long_seq), canonical(chartr("ATGC", "TACG", long_seq)))
  expect_equal(canonical(long_seq, minimal = FALSE), canonical(chartr("ATGC", "TACG", long_seq), minimal = FALSE))
})
```

### Verify input

Finally, let's make sure that the input is a string, and a DNA sequence.

```{r}
complementary = function(seq){
  if (!is.character(seq)){
    stop(paste("Expecting a string. Was given", typeof(seq)))
  }
  seq = toupper(seq)
  if (!str_detect(seq, '^[ACGT]*$')){
    stop(paste("Expecting a DNA sequence consisting of only A, C, G, T"))
  }
  
  complement = chartr("ATGCN", "TACGN", seq) # chartr maps characters to characters. We use this to determine the complementary basepairs
  return(complement)
}
```

```{r}
canonical = function(seq, minimal = TRUE){
  if (!is.character(seq)){
    stop(paste("Expecting a string. Was given", typeof(seq)))
  }
  seq = toupper(seq)
  if (!str_detect(seq, '^[ACGT]*$')){
    stop(paste("Expecting a DNA sequence consisting of only A, C, G, T"))
  }
  
  complement = complementary(seq)
  
  if (minimal){
    return(min(seq, complement))
  }
  else{
    return(max(seq, complement))
  }
}
```

Let's test the error messages.

```{r error=TRUE}
complementary(123)
```

```{r error=TRUE}
canonical(123)
```

```{r error=TRUE}
canonical("Testing a non-DNA sequence")
```

Excellent! We now have a `canonical` and `complementary` function that can be used in a custom package.

